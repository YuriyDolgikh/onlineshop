<div class="modal-content">
    <div class="modal-header">
        <h2>ðŸ“‹ Order Management Details</h2>
        <button onclick="closeModal()" class="modal-close-btn">&times;</button>
    </div>

    <div class="modal-body">
        <!-- General Description -->
        <div class="description-section">
            <h3>General Description</h3>
            <p>
                OrderService is responsible for managing user orders.
                Performs operations for retrieving, updating status, canceling and confirming order payments.
                Provides full order lifecycle from creation to completion.
            </p>
        </div>

        <!-- Main Service Methods -->
        <div class="methods-section">
            <h3>Main Service Methods</h3>

            <div class="method-card">
                <h4>getOrderById(Integer orderId)</h4>
                <p>Gets order by ID.</p>
                <div class="method-steps">
                    <div>â€¢ Checks access to order via isAccessToOrderAllowed()</div>
                    <div>â€¢ Finds order by ID, if not found - throws NotFoundException</div>
                    <div>â€¢ Returns OrderResponseDto via OrderConverter</div>
                </div>
            </div>

            <div class="method-card">
                <h4>getOrdersByUser(Integer userId)</h4>
                <p>Gets list of user's orders.</p>
                <div class="method-steps">
                    <div>â€¢ Checks that userId is not null</div>
                    <div>â€¢ Finds user by ID, if not found - throws NotFoundException</div>
                    <div>â€¢ Checks that regular user requests only their own orders, otherwise AccessDeniedException</div>
                    <div>â€¢ Gets order list via OrderRepository</div>
                    <div>â€¢ Returns list of OrderResponseDto via OrderConverter</div>
                </div>
            </div>

            <div class="method-card">
                <h4>updateOrderStatus(Integer orderId, String newStatus)</h4>
                <p>Updates order status.</p>
                <div class="method-steps">
                    <div>â€¢ Checks access to order via isAccessToOrderAllowed()</div>
                    <div>â€¢ Validates newStatus is not null or blank</div>
                    <div>â€¢ Finds order by ID, if not found - throws NotFoundException</div>
                    <div>â€¢ Converts string status to Order.Status enum</div>
                    <div>â€¢ Updates status and saves order</div>
                    <div>â€¢ Returns updated OrderResponseDto</div>
                </div>
            </div>

            <div class="method-card">
                <h4>cancelOrder(Integer orderId)</h4>
                <p>Cancels order.</p>
                <div class="method-steps">
                    <div>â€¢ Checks access to order via isAccessToOrderAllowed()</div>
                    <div>â€¢ Finds order by ID, if not found - throws NotFoundException</div>
                    <div>â€¢ Validates order is in PENDING_PAYMENT status</div>
                    <div>â€¢ Sets status to CANCELLED and saves</div>
                </div>
            </div>

            <div class="method-card">
                <h4>confirmPayment(Integer orderId, String paymentMethod)</h4>
                <p>Confirms order payment and sends confirmation by email.</p>
                <div class="method-steps">
                    <div>â€¢ Gets current user</div>
                    <div>â€¢ Finds order by ID, checks that it belongs to user</div>
                    <div>â€¢ Recalculates order price based on current product prices</div>
                    <div>â€¢ Validates payment method and order status</div>
                    <div>â€¢ Sets status to PAID and saves</div>
                    <div>â€¢ Clears user's cart</div>
                    <div>â€¢ Returns OrderResponseDto</div>
                </div>
            </div>

            <div class="method-card">
                <h4>updateOrderDelivery(Integer orderId, OrderRequestDto orderRequestDto)</h4>
                <p>Updates order delivery details.</p>
                <div class="method-steps">
                    <div>â€¢ Checks access to order via isAccessToOrderAllowed()</div>
                    <div>â€¢ Validates order is in PENDING_PAYMENT or PAID status</div>
                    <div>â€¢ Validates delivery address and contact phone</div>
                    <div>â€¢ Updates delivery method, address and phone</div>
                    <div>â€¢ Saves updated order</div>
                    <div>â€¢ Returns updated OrderResponseDto</div>
                </div>
            </div>

            <div class="method-card">
                <h4>getOrderStatusDto(Integer orderId)</h4>
                <p>Gets order status information.</p>
                <div class="method-steps">
                    <div>â€¢ Checks access to order via isAccessToOrderAllowed()</div>
                    <div>â€¢ Finds order by ID, if not found - throws NotFoundException</div>
                    <div>â€¢ Returns OrderStatusResponseDto with status and update timestamp</div>
                </div>
            </div>
        </div>

        <!-- Endpoints -->
        <div class="endpoints-section">
            <h3>REST Endpoints</h3>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method get">GET</span>
                    <span class="endpoint-path">/v1/orders/{orderId}</span>
                    <span class="role-badge role-user">USER</span>
                    <span class="role-badge role-admin">ADMIN</span>
                    <span class="role-badge role-manager">MANAGER</span>
                </div>
                <p>Get order by ID (users see only their own orders)</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method get">GET</span>
                    <span class="endpoint-path">/v1/orders/ordersHistory/{userId}</span>
                    <span class="role-badge role-user">USER</span>
                    <span class="role-badge role-admin">ADMIN</span>
                    <span class="role-badge role-manager">MANAGER</span>
                </div>
                <p>Get user's order history</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method delete">DELETE</span>
                    <span class="endpoint-path">/v1/orders/cancel/{orderId}</span>
                    <span class="role-badge role-user">USER</span>
                    <span class="role-badge role-admin">ADMIN</span>
                    <span class="role-badge role-manager">MANAGER</span>
                </div>
                <p>Cancel order (only orders in PENDING_PAYMENT status)</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method post">POST</span>
                    <span class="endpoint-path">/v1/orders/confirm/{orderId}/{payMethod}</span>
                    <span class="role-badge role-user">USER</span>
                </div>
                <p>Confirm order payment with email confirmation sending</p>
            </div>
        </div>

        <!-- Implementation Features -->
        <div class="features-section">
            <h3>ðŸ”§ Implementation Features</h3>
            <div class="method-card">
                <div class="method-steps">
                    <div>â€¢ <strong>Access Security:</strong> Users see only their own orders, ADMIN/MANAGER have access to all</div>
                    <div>â€¢ <strong>Order Lifecycle:</strong> Support for statuses PENDING_PAYMENT, PAID, CANCELLED, DELIVERED</div>
                    <div>â€¢ <strong>Email Notifications:</strong> Automatic sending of payment confirmations with PDF invoice</div>
                    <div>â€¢ <strong>Data Validation:</strong> Validation of delivery data and payment methods correctness</div>
                    <div>â€¢ <strong>Error Handling:</strong> Detailed exceptions for various error scenarios</div>
                    <div>â€¢ <strong>Payment Integration:</strong> Support for various payment methods (CREDIT_CARD, PAYPAL, BANK_TRANSFER)</div>
                    <div>â€¢ <strong>Price Recalculation:</strong> Automatic price update based on current product prices and discounts</div>
                    <div>â€¢ <strong>Cart Integration:</strong> Automatic cart clearing after successful payment</div>
                </div>
            </div>
        </div>

        <!-- Business Logic -->
        <div class="business-logic-section">
            <h3>ðŸ’¼ Business Logic</h3>
            <div class="method-card">
                <div class="method-steps">
                    <div>â€¢ <strong>Order Statuses:</strong> Clear workflow of status changes from creation to completion</div>
                    <div>â€¢ <strong>Fixed Prices:</strong> Product prices are recalculated at payment confirmation moment</div>
                    <div>â€¢ <strong>Automation:</strong> PDF invoice generation and email sending upon payment confirmation</div>
                    <div>â€¢ <strong>Audit:</strong> Saving order creation and update dates for tracking history</div>
                    <div>â€¢ <strong>Status Restrictions:</strong> Cancellation allowed only for PENDING_PAYMENT orders</div>
                    <div>â€¢ <strong>Delivery Updates:</strong> Delivery details can be updated for PENDING_PAYMENT and PAID orders</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button onclick="closeModal()" class="btn btn-primary">Close</button>
    </div>
</div>