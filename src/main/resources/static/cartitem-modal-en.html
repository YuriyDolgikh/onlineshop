<div class="modal-content">
    <div class="modal-header">
        <h2>üìù Cart Items Details</h2>
        <button onclick="closeModal()" class="modal-close-btn">&times;</button>
    </div>

    <div class="modal-body">
        <!-- General Description -->
        <div class="description-section">
            <h3>General Description</h3>
            <p>
                CartItemService is responsible for managing products in user's shopping cart.
                It provides adding, removing, updating and retrieving cart items (CartItem),
                integrated with product and cart services to ensure data integrity.
            </p>
        </div>

        <!-- Main Service Methods -->
        <div class="methods-section">
            <h3>Main Service Methods</h3>

            <div class="method-card">
                <h4>addItemToCart(CartItemRequestDto)</h4>
                <p>Adds product to current user's cart.</p>
                <div class="method-steps">
                    <div>‚Ä¢ Validates input data (productId and quantity not null)</div>
                    <div>‚Ä¢ Checks that quantity ‚â• 1</div>
                    <div>‚Ä¢ Verifies product existence via ProductService</div>
                    <div>‚Ä¢ Gets current user and their cart</div>
                    <div>‚Ä¢ Checks if product is already in cart via getCartItemFromCart()</div>
                    <div>‚Ä¢ If product found - increases quantity</div>
                    <div>‚Ä¢ If not - creates new CartItem and links to cart</div>
                    <div>‚Ä¢ Saves changes in CartItemRepository</div>
                    <div>‚Ä¢ Updates cart via CartService.saveCart()</div>
                    <div>‚Ä¢ Returns CartItemSympleResponseDto</div>
                </div>
            </div>

            <div class="method-card">
                <h4>removeItemFromCart(Integer productId)</h4>
                <p>Removes specific product from current user's cart.</p>
                <div class="method-steps">
                    <div>‚Ä¢ Checks that productId is not null</div>
                    <div>‚Ä¢ Gets current cart via CartService</div>
                    <div>‚Ä¢ Searches CartItem by productId in cart items</div>
                    <div>‚Ä¢ If not found - NotFoundException</div>
                    <div>‚Ä¢ Removes item from cart and from CartItemRepository</div>
                    <div>‚Ä¢ Saves updated cart</div>
                    <div>‚Ä¢ Returns CartItemResponseDto of removed element</div>
                </div>
            </div>

            <div class="method-card">
                <h4>updateItemInCart(CartItemUpdateDto)</h4>
                <p>Updates product quantity in cart.</p>
                <div class="method-steps">
                    <div>‚Ä¢ Validates data (productId and quantity not null)</div>
                    <div>‚Ä¢ Checks that quantity ‚â• 1</div>
                    <div>‚Ä¢ Verifies product existence via ProductService</div>
                    <div>‚Ä¢ Searches CartItem in cart via getCartItemFromCart()</div>
                    <div>‚Ä¢ If not found - NotFoundException</div>
                    <div>‚Ä¢ Sets new quantity and saves in CartItemRepository</div>
                    <div>‚Ä¢ Returns CartItemResponseDto of updated element</div>
                </div>
            </div>

            <div class="method-card">
                <h4>getCartItems()</h4>
                <p>Returns all cart items of current user.</p>
                <div class="method-steps">
                    <div>‚Ä¢ Gets current cart via CartService</div>
                    <div>‚Ä¢ Extracts Set<CartItem> from cart</div>
                    <div>‚Ä¢ Converts to Set<CartItemFullResponseDto> via CartItemConverter</div>
                    <div>‚Ä¢ Returns result</div>
                </div>
            </div>
        </div>

        <!-- Helper Methods -->
        <div class="methods-section">
            <h3>Helper Methods</h3>

            <div class="method-card">
                <h4>getCartItemFromCart(Integer productId)</h4>
                <p>Finds specific cart item by product ID.</p>
                <div class="method-steps">
                    <div>‚Ä¢ Gets current user</div>
                    <div>‚Ä¢ Extracts user's cart</div>
                    <div>‚Ä¢ Searches CartItem by productId in cart items</div>
                    <div>‚Ä¢ Returns Optional<CartItem></div>
                </div>
            </div>
        </div>

        <!-- DTO Objects -->
        <div class="methods-section">
            <h3>üìä DTO Objects</h3>

            <div class="method-card">
                <h4>CartItemRequestDto</h4>
                <p>For adding product to cart</p>
                <div class="method-steps">
                    <div>‚Ä¢ productId: Integer - product identifier</div>
                    <div>‚Ä¢ quantity: Integer - quantity (‚â• 1)</div>
                </div>
            </div>

            <div class="method-card">
                <h4>CartItemUpdateDto</h4>
                <p>For updating product quantity</p>
                <div class="method-steps">
                    <div>‚Ä¢ productId: Integer - product identifier</div>
                    <div>‚Ä¢ quantity: Integer - new quantity (‚â• 1)</div>
                </div>
            </div>

            <div class="method-card">
                <h4>CartItemResponseDto</h4>
                <p>Full information about product in cart</p>
                <div class="method-steps">
                    <div>‚Ä¢ Contains full product data and quantity</div>
                </div>
            </div>

            <div class="method-card">
                <h4>CartItemSympleResponseDto</h4>
                <p>Simplified version for add operation response</p>
                <div class="method-steps">
                    <div>‚Ä¢ Contains basic information about added product</div>
                </div>
            </div>

            <div class="method-card">
                <h4>CartItemFullResponseDto</h4>
                <p>For getting all cart items</p>
                <div class="method-steps">
                    <div>‚Ä¢ Used in getCartItems()</div>
                </div>
            </div>
        </div>

        <!-- Endpoints -->
        <div class="endpoints-section">
            <h3>REST Endpoints</h3>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method post">POST</span>
                    <span class="endpoint-path">/v1/cartItems</span>
                    <span class="role-badge role-user">USER</span>
                </div>
                <p>Add new product to user's cart. Returns CartItemSympleResponseDto.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method delete">DELETE</span>
                    <span class="endpoint-path">/v1/cartItems/{productId}</span>
                    <span class="role-badge role-user">USER</span>
                </div>
                <p>Remove specific product from cart by product ID. Returns CartItemResponseDto.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method put">PUT</span>
                    <span class="endpoint-path">/v1/cartItems</span>
                    <span class="role-badge role-user">USER</span>
                </div>
                <p>Update product quantity in cart. Returns CartItemResponseDto.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method get">GET</span>
                    <span class="endpoint-path">/v1/cartItems</span>
                    <span class="role-badge role-user">USER</span>
                </div>
                <p>Get all cart items of current user. Returns Set<CartItemFullResponseDto>.</p>
            </div>
        </div>

        <!-- Implementation Features -->
        <div class="features-section">
            <h3>üîß Implementation Features</h3>
            <div class="method-card">
                <div class="method-steps">
                    <div>‚Ä¢ <strong>Integration with ProductService:</strong> Verifying product existence before operations</div>
                    <div>‚Ä¢ <strong>Data Validation:</strong> Checking null values and minimum quantity</div>
                    <div>‚Ä¢ <strong>Transaction Safety:</strong> All operations performed within transactions</div>
                    <div>‚Ä¢ <strong>DTO Conversion:</strong> Using CartItemConverter for data transformation</div>
                    <div>‚Ä¢ <strong>Cart Synchronization:</strong> Automatic cart update after changes</div>
                    <div>‚Ä¢ <strong>Error Handling:</strong> Detailed exceptions for different scenarios</div>
                </div>
            </div>
        </div>

        <!-- Business Logic -->
        <div class="business-logic-section">
            <h3>üíº Business Logic</h3>
            <div class="method-card">
                <div class="method-steps">
                    <div>‚Ä¢ <strong>Quantity Management:</strong> Automatic quantity increase when adding existing product</div>
                    <div>‚Ä¢ <strong>Data Integrity:</strong> Verifying product existence before cart operations</div>
                    <div>‚Ä¢ <strong>Input Validation:</strong> Ensuring data correctness before saving</div>
                    <div>‚Ä¢ <strong>Query Optimization:</strong> Minimizing database calls</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button onclick="closeModal()" class="btn btn-primary">Close</button>
    </div>
</div>