<div class="modal-content">
    <div class="modal-header">
        <h2>ðŸ‘¥ User Management Details</h2>
        <button onclick="closeModal()" class="modal-close-btn">&times;</button>
    </div>

    <div class="modal-body">
        <!-- General Description -->
        <div class="description-section">
            <h3>General Description</h3>
            <p>
                UserService is responsible for managing users, including registration,
                email confirmation, data updates, deletion, user recovery and password encryption,
                as well as obtaining information about the current user. Integrated with Spring Security and ConfirmationCodeService.
            </p>
        </div>

        <!-- Main Service Methods -->
        <div class="methods-section">
            <h3>Main Service Methods</h3>

            <div class="method-card">
                <h4>registration(UserRequestDto request)</h4>
                <p>Registers a new user.</p>
                <div class="method-steps">
                    <div>â€¢ Checks if a user with this email already exists</div>
                    <div>â€¢ Validates required fields (name and hashPassword)</div>
                    <div>â€¢ Creates a new user with USER role and NOT_CONFIRMED status</div>
                    <div>â€¢ Initializes orders and favorites collections</div>
                    <div>â€¢ Creates shopping cart for the user</div>
                    <div>â€¢ Saves the user to the database</div>
                    <div>â€¢ Generates and sends confirmation code via confirmationCodeService</div>
                    <div>â€¢ Returns UserResponseDto</div>
                </div>
            </div>

            <div class="method-card">
                <h4>confirmationEmail(String code)</h4>
                <p>Confirms user email using the code.</p>
                <div class="method-steps">
                    <div>â€¢ Validates confirmation code</div>
                    <div>â€¢ Checks confirmation code expiration</div>
                    <div>â€¢ If code expired - generates new one and sends to user</div>
                    <div>â€¢ Changes user status to CONFIRMED</div>
                    <div>â€¢ Saves the user</div>
                    <div>â€¢ Returns success confirmation message</div>
                </div>
            </div>

            <div class="method-card">
                <h4>updateUser(Integer userId, UserUpdateRequestDto updateRequest)</h4>
                <p>Updates user data.</p>
                <div class="method-steps">
                    <div>â€¢ Checks if the user exists</div>
                    <div>â€¢ Verifies that update is performed by the current user</div>
                    <div>â€¢ Updates provided fields (username, phoneNumber, hashPassword)</div>
                    <div>â€¢ Encrypts password via PasswordEncoder when updating</div>
                    <div>â€¢ Saves changes</div>
                    <div>â€¢ Returns UserResponseDto</div>
                </div>
            </div>

            <div class="method-card">
                <h4>deleteUser(Integer userId)</h4>
                <p>Performs logical user deletion.</p>
                <div class="method-steps">
                    <div>â€¢ Checks if the user exists</div>
                    <div>â€¢ Prevents ADMIN user deletion</div>
                    <div>â€¢ Verifies current user permissions</div>
                    <div>â€¢ Deletes user confirmation codes via confirmationCodeService</div>
                    <div>â€¢ Changes status to DELETED</div>
                    <div>â€¢ Saves the user</div>
                    <div>â€¢ Returns UserResponseDto</div>
                </div>
            </div>

            <div class="method-card">
                <h4>renewUser(String email)</h4>
                <p>Restores a deleted user.</p>
                <div class="method-steps">
                    <div>â€¢ Validates email</div>
                    <div>â€¢ Checks that the user is deleted (DELETED status)</div>
                    <div>â€¢ Generates new confirmation code</div>
                    <div>â€¢ Changes status to NOT_CONFIRMED</div>
                    <div>â€¢ Saves the user</div>
                    <div>â€¢ Returns UserResponseDto</div>
                </div>
            </div>

            <div class="method-card">
                <h4>getAllUsers(Pageable pageable)</h4>
                <p>Gets paginated list of users.</p>
                <div class="method-steps">
                    <div>â€¢ Returns page with UserResponseDto</div>
                    <div>â€¢ Uses pagination via Pageable</div>
                </div>
            </div>

            <div class="method-card">
                <h4>getCurrentUser()</h4>
                <p>Gets the current authenticated user.</p>
                <div class="method-steps">
                    <div>â€¢ Uses Spring Security mechanisms to get current user</div>
                    <div>â€¢ Returns current user data</div>
                </div>
            </div>

            <div class="method-card">
                <h4>getUserByEmail(String email)</h4>
                <p>Gets user by email address.</p>
                <div class="method-steps">
                    <div>â€¢ Searches user by email</div>
                    <div>â€¢ Returns UserResponseDto</div>
                </div>
            </div>
        </div>

        <!-- Endpoints -->
        <div class="endpoints-section">
            <h3>REST Endpoints</h3>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method post">POST</span>
                    <span class="endpoint-path">/v1/users/register</span>
                    <span class="role-badge role-public">PUBLIC</span>
                </div>
                <p>Register a new user. User receives email with confirmation code.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method post">POST</span>
                    <span class="endpoint-path">/v1/users/login</span>
                    <span class="role-badge role-public">PUBLIC</span>
                </div>
                <p>User authentication and JWT token retrieval.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method get">GET</span>
                    <span class="endpoint-path">/v1/users/confirmation?code={code}</span>
                    <span class="role-badge role-public">PUBLIC</span>
                </div>
                <p>Email address confirmation using confirmation code. Automatically generates new code when expired.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method put">PUT</span>
                    <span class="endpoint-path">/v1/users/{userId}</span>
                    <span class="role-badge role-user">USER, MANAGER, ADMIN</span>
                </div>
                <p>Update user information. Users can only update their own profile. Password automatically encrypted.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method delete">DELETE</span>
                    <span class="endpoint-path">/v1/users/{userId}</span>
                    <span class="role-badge role-user">USER, MANAGER, ADMIN</span>
                </div>
                <p>Delete user account logically. ADMIN can delete any user except other ADMINS. Deletes related confirmation codes.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method get">GET</span>
                    <span class="endpoint-path">/v1/users/renew/{email}</span>
                    <span class="role-badge role-user">USER, MANAGER, ADMIN</span>
                </div>
                <p>Restore deleted user account. Generates new confirmation code.</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method get">GET</span>
                    <span class="endpoint-path">/v1/users/admin/all?page=0&size=20</span>
                    <span class="role-badge role-admin">ADMIN</span>
                </div>
                <p>Get paginated list of all users. Admin only.</p>
                <div class="method-steps">
                    <div>â€¢ Parameters: page (default 0), size (default 20)</div>
                </div>
            </div>
        </div>

        <!-- Implementation Features -->
        <div class="features-section">
            <h3>ðŸ”§ Implementation Features</h3>
            <div class="method-card">
                <div class="method-steps">
                    <div>â€¢ <strong>Password Security:</strong> Passwords encoded via PasswordEncoder</div>
                    <div>â€¢ <strong>Email Confirmation:</strong> Mandatory email confirmation before account activation</div>
                    <div>â€¢ <strong>Permission Separation:</strong> Different access levels for users, MANAGER and ADMIN</div>
                    <div>â€¢ <strong>Logical Deletion:</strong> Users marked as DELETED instead of physical deletion</div>
                    <div>â€¢ <strong>Account Recovery:</strong> Ability to restore deleted accounts</div>
                    <div>â€¢ <strong>Spring Security:</strong> Integration with Spring Security for authentication and authorization</div>
                    <div>â€¢ <strong>Pagination:</strong> Pagination support for user lists</div>
                    <div>â€¢ <strong>Code Validation:</strong> Automatic confirmation code expiration check</div>
                    <div>â€¢ <strong>Cart Integration:</strong> Automatic cart creation during registration</div>
                </div>
            </div>
        </div>

        <!-- Business Logic -->
        <div class="business-logic-section">
            <h3>ðŸ’¼ Business Logic</h3>
            <div class="method-card">
                <div class="method-steps">
                    <div>â€¢ <strong>Registration:</strong> Registration process with email confirmation for security</div>
                    <div>â€¢ <strong>Authentication:</strong> JWT-based authentication for secure access</div>
                    <div>â€¢ <strong>Profile Management:</strong> Users can update their data</div>
                    <div>â€¢ <strong>Access Control:</strong> Different roles with different permission levels</div>
                    <div>â€¢ <strong>Recovery:</strong> Mechanism for restoring deleted accounts</div>
                    <div>â€¢ <strong>Administration:</strong> Separate methods for administrative management</div>
                    <div>â€¢ <strong>User Statuses:</strong> NOT_CONFIRMED â†’ CONFIRMED â†’ DELETED â†’ NOT_CONFIRMED</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button onclick="closeModal()" class="btn btn-primary">Close</button>
    </div>
</div>