<div class="modal-content">
    <div class="modal-header">
        <h2>ðŸ“¦ Order Items Details</h2>
        <button onclick="closeModal()" class="modal-close-btn">&times;</button>
    </div>

    <div class="modal-body">
        <!-- General Description -->
        <div class="description-section">
            <h3>General Description</h3>
            <p>
                OrderItemService is responsible for managing products added to user orders.
                Performs operations for adding, deleting and updating product quantities in current user order
                with PENDING_PAYMENT status. Provides flexible management of order contents until payment moment.
            </p>
        </div>

        <!-- Main Service Methods -->
        <div class="methods-section">
            <h3>Main Service Methods</h3>

            <div class="method-card">
                <h4>addItemToOrder(OrderItemRequestDto dto)</h4>
                <p>Adds product to current user's open order.</p>
                <div class="method-steps">
                    <div>â€¢ Validates input data</div>
                    <div>â€¢ Checks that productId and quantity are not null and quantity is greater than zero</div>
                    <div>â€¢ Finds product by provided productId in ProductRepository</div>
                    <div>â€¢ Calculates price at purchase moment - if product has discount, price with discount is applied</div>
                    <div>â€¢ Creates new OrderItem object, adds it to current order and saves to database</div>
                    <div>â€¢ Returns DTO of added order item (OrderItemResponseDto)</div>
                </div>
            </div>

            <div class="method-card">
                <h4>deleteItemFromOrder(Integer orderItemId)</h4>
                <p>Deletes specific product from order by order item identifier.</p>
                <div class="method-steps">
                    <div>â€¢ Checks that orderItemId is not null</div>
                    <div>â€¢ Finds corresponding element in OrderItemRepository</div>
                    <div>â€¢ Deletes element from current order's orderItems collection (orphanRemoval mechanism included)</div>
                    <div>â€¢ Deletes element from database and saves updated order</div>
                </div>
            </div>

            <div class="method-card">
                <h4>updateItemQuantityInOrder(OrderItemUpdateDto dto)</h4>
                <p>Updates quantity of specific product in user's order.</p>
                <div class="method-steps">
                    <div>â€¢ Validates input data (dto != null, quantity > 0)</div>
                    <div>â€¢ Checks if order item exists by orderItemId</div>
                    <div>â€¢ Checks if order belongs to current user (prevents modification of someone else's order)</div>
                    <div>â€¢ Updates product quantity, saves changes in OrderItemRepository</div>
                    <div>â€¢ Returns updated order item as DTO (OrderItemResponseDto)</div>
                </div>
            </div>

            <div class="method-card">
                <h4>getCurrentOrder() [private method]</h4>
                <p>Returns current user's open order.</p>
                <div class="method-steps">
                    <div>â€¢ Gets current user via UserService</div>
                    <div>â€¢ Searches among user's orders for one with PENDING_PAYMENT status</div>
                    <div>â€¢ If such order not found - throws NotFoundException</div>
                </div>
            </div>
        </div>

        <!-- Endpoints -->
        <div class="endpoints-section">
            <h3>REST Endpoints</h3>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method delete">DELETE</span>
                    <span class="endpoint-path">/v1/orderItems/{orderItemId}</span>
                    <span class="role-badge role-user">USER</span>
                </div>
                <p>Delete product from order by order item ID</p>
            </div>

            <div class="endpoint-detail">
                <div class="endpoint-header">
                    <span class="http-method put">PUT</span>
                    <span class="endpoint-path">/v1/orderItems</span>
                    <span class="role-badge role-user">USER</span>
                </div>
                <p>Update product quantity in order</p>
            </div>
        </div>

        <!-- Implementation Features -->
        <div class="features-section">
            <h3>ðŸ”§ Implementation Features</h3>
            <div class="method-card">
                <div class="method-steps">
                    <div>â€¢ <strong>Security:</strong> Checking order ownership by current user</div>
                    <div>â€¢ <strong>Fixed Prices:</strong> Product price is fixed when added to order</div>
                    <div>â€¢ <strong>Discount Accounting:</strong> Automatic discount application when calculating price</div>
                    <div>â€¢ <strong>Orphan Removal:</strong> Automatic element deletion when removed from collection</div>
                    <div>â€¢ <strong>Validation:</strong> Checking quantity correctness and product existence</div>
                    <div>â€¢ <strong>Limitations:</strong> Changes possible only for orders with PENDING_PAYMENT status</div>
                </div>
            </div>
        </div>

        <!-- Business Logic -->
        <div class="business-logic-section">
            <h3>ðŸ’¼ Business Logic</h3>
            <div class="method-card">
                <div class="method-steps">
                    <div>â€¢ <strong>Pricing Policy:</strong> Prices are fixed when added to order, protecting from changes</div>
                    <div>â€¢ <strong>Change Flexibility:</strong> User can modify order contents until payment moment</div>
                    <div>â€¢ <strong>Integrity Control:</strong> Checking product existence before adding to order</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button onclick="closeModal()" class="btn btn-primary">Close</button>
    </div>
</div>