User Service Description

UserService – сервисный класс для управления пользователями в системе интернет-магазина.
Реализует интерфейс UserServiceInterface. Сервис предоставляет функционал регистрации,
подтверждения электронной почты, обновления данных, удаления и восстановления пользователей,
а также получения информации о текущем пользователе.

Аннотации:

@Service – помечает класс как сервисный компонент Spring.

@RequiredArgsConstructor – Lombok генерирует конструктор для всех финальных полей, облегчая внедрение зависимостей.

Зависимости:

UserRepository – репозиторий для работы с сущностью User.

UserConverter – конвертер между DTO и сущностью User.

ConfirmationCodeService – сервис для управления кодами подтверждения email.

PasswordEncoder – для хэширования паролей пользователей.

Основные методы сервиса:

1.registration(UserRequestDto request)

Регистрация нового пользователя.

Проверяет уникальность email.

Проверяет наличие имени и пароля.

Создаёт пользователя со статусом NOT_CONFIRMED и ролью USER.

Генерирует код подтверждения и отправляет пользователю.

Возвращает UserResponseDto.

2.getAllUsers()

Возвращает список всех пользователей в виде DTO.

3.getUserById(Integer id)

Возвращает пользователя по ID в виде DTO.

Если пользователь не найден – выбрасывается NotFoundException.

4.confirmationEmail(String code)

Подтверждает email пользователя по коду.

Меняет статус пользователя на CONFIRMED.

Возвращает сообщение об успешном подтверждении.

5.updateUser(Integer userId, UserUpdateRequestDto updateRequest)

Обновляет данные пользователя (имя, телефон, пароль) по переданным полям.

Проверяет, что текущий пользователь может изменять только собственные данные.

Хэширует пароль перед сохранением.

Возвращает обновлённый DTO.

6.deleteUser(Integer userId)

"Удаляет" пользователя, устанавливая статус DELETED.

Проверяет, что ADMIN не может быть удалён.

Проверяет права текущего пользователя.

Удаляет коды подтверждения для пользователя.

Возвращает DTO удалённого пользователя.

7.renewUser(String email)

Восстанавливает удалённого пользователя.

Генерирует новый код подтверждения.

Меняет статус пользователя на NOT_CONFIRMED.

Возвращает DTO восстановленного пользователя.

8.getUserByIdForAdmin(Integer id)

Возвращает пользователя по ID без конвертации в DTO (для администратора).

9.getAllUsersFullDetails()

Возвращает полный список всех пользователей (с сущностями).

10.getUserByEmail(String email)

Получает пользователя по email и возвращает DTO.

11.getUserByEmailOrThrow(String email)

Получает пользователя по email или выбрасывает исключение NotFoundException.

12.getCurrentUser()

Получает текущего авторизованного пользователя на основе email.

13.getCurrentUserEmail()

Возвращает email текущего пользователя из контекста Spring Security.

14.saveUser(User user)

Сохраняет пользователя в базу данных.




