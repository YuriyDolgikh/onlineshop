Описание сервиса OrderItemService
----------------------------------

1. Назначение класса:
   Класс OrderItemService отвечает за бизнес-логику работы с товарами в заказах (OrderItems) онлайн-магазина.
   Он реализует интерфейс OrderItemServiceInterface и выполняет операции добавления, удаления и изменения количества товаров в заказе.

2. Основные зависимости:
   - OrderItemRepository — доступ к базе данных для сущности OrderItem.
   - ProductRepository — доступ к базе данных для сущности Product.
   - OrderItemConverter — преобразование между сущностью OrderItem и DTO-классами OrderItemRequestDto / OrderItemResponseDto.
   - UserService — получение текущего пользователя и его заказов.

3. Основные методы:

   • addItemToOrder(OrderItemRequestDto dto)
     Добавляет товар в текущий открытый заказ пользователя.
     Проверяет корректность данных (ID продукта и количество), наличие продукта в базе.
     Рассчитывает цену покупки (с учётом скидки, если есть).
     Сохраняет OrderItem в базе и возвращает DTO OrderItemResponseDto.

   • deleteItemFromOrder(Integer orderItemId)
     Удаляет товар из заказа по идентификатору OrderItem.
     Сначала удаляет связь с заказом, затем удаляет OrderItem из базы.
     Используется механизм orphanRemoval для удаления зависимостей.

   • updateItemQuantityInOrder(OrderItemUpdateDto dto)
     Обновляет количество товара в заказе.
     Проверяет корректность запроса и минимальное количество (1).
     Сохраняет изменения и возвращает обновлённый DTO OrderItemResponseDto.

4. Вспомогательные методы:
   • getCurrentOrder(User user)
     Возвращает текущий открытый заказ пользователя.
     Если открытого заказа нет — выбрасывает NotFoundException.

5. Используемые исключения:
   - IllegalArgumentException — если обязательные параметры null или количество товара меньше 1.
   - BadRequestException — если DTO-запрос null.
   - NotFoundException — если продукт или OrderItem не найден.

6. Особенности:
   - Методы аннотированы @Transactional — все операции с базой данных выполняются в рамках транзакции.
   - Класс аннотирован @Service — компонент Spring с бизнес-логикой.
   - Lombok-аннотация @RequiredArgsConstructor автоматически создаёт конструктор для final-полей.

7. Вывод:
   OrderItemService обеспечивает безопасное управление товарами в заказах пользователей,
   позволяя добавлять, удалять и обновлять позиции заказа с полной проверкой корректности данных и целостности транзакций.
