Описание сервиса OrderItemService

Сервис OrderItemService отвечает за управление товарами, добавленными в заказы пользователя.
Выполняет операции добавления, удаления и обновления количества товаров в текущем заказе пользователя со статусом PENDING_PAYMENT.

Основные методы:

1. addItemToOrder(OrderItemRequestDto dto)
   Добавляет товар в текущий открытый заказ пользователя.

   * Проверяет корректность входных данных.

   * Проверяет, что productId и quantity не равны null и что количество больше нуля.

   * Находит товар по переданному productId в ProductRepository.

   * Рассчитывает цену на момент покупки — если у товара есть скидка, применяется цена с учётом скидки.

   * Создаёт новый объект OrderItem, добавляет его в текущий заказ и сохраняет в базе данных.

   * Возвращает DTO добавленного элемента заказа (OrderItemResponseDto).

2. deleteItemFromOrder(Integer orderItemId)
   Удаляет конкретный товар из заказа по идентификатору элемента заказа.

   * Проверяет, что orderItemId не равен null.
 
   * Находит соответствующий элемент в OrderItemRepository.

   * Удаляет элемент из коллекции orderItems текущего заказа (включается механизм orphanRemoval).

   * Удаляет элемент из базы данных и сохраняет обновлённый заказ.

3. updateItemQuantityInOrder(OrderItemUpdateDto dto)
   Обновляет количество конкретного товара в заказе пользователя.

   * Проверяет корректность входных данных (dto != null, количество больше нуля).

   * Проверяет, существует ли элемент заказа по orderItemId.

   * Проверяет, принадлежит ли заказ текущему пользователю (исключает возможность изменения чужого заказа).

   * Обновляет количество товара, сохраняет изменения в OrderItemRepository.

   * Возвращает обновлённый элемент заказа в виде DTO (OrderItemResponseDto).

4. getCurrentOrder() [приватный метод]
   Возвращает текущий открытый заказ пользователя.

   * Получает текущего пользователя через UserService.
 
   * Ищет среди заказов пользователя тот, у которого статус PENDING_PAYMENT.

   * Если такой заказ не найден — выбрасывает исключение NotFoundException.
